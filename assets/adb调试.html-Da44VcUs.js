import{_ as s,c as a,d as n,o as i}from"./app-CP_lir0m.js";const l="/assets/2025-04-19-10-46-06-image-BpSGUuDx.png",d="/assets/2025-04-19-12-40-55-image-Bdv43sPT.png",p={};function t(r,e){return i(),a("div",null,e[0]||(e[0]=[n(`<p>adb调试</p><p>连接同一个网络，打开电视的开发者模式，开启adb调试。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">//连接到电视 TV 设备</span>
<span class="line">adb connect your_tv_ip:5555</span>
<span class="line">//查看已连接的设备</span>
<span class="line">adb devices</span>
<span class="line">//</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 Android Studio 中选择调试设备</p><ul><li>打开 Android Studio，运行你的 TV 应用。</li><li>当弹出 “Select Deployment Target” 对话框时，选择你刚刚连接的电视 TV 设备</li></ul><p>开始调试</p><p>点击 Android Studio 中的 “Debug” 按钮，这样就能在电视 TV 设备上远程调试你的应用了。</p><p>注意事项</p><ul><li>要是连接失败，你可以尝试重新启动电视 TV 设备和 ADB 服务。在命令行中输入 <code>adb kill-server</code> 来停止 ADB 服务，接着输入 <code>adb start-server</code> 重新启动服务。</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">C:\\Users\\Administrator&gt;adb connect 192.168.0.101:5555</span>
<span class="line">&#39;adb&#39; 不是内部或外部命令，也不是可运行的程序</span>
<span class="line">或批处理文件。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查 C:\\Users\\Administrator\\AppData\\Local\\Android\\Sdk\\platform-tools目录下有无adb.exe文件</p><img src="`+l+`" title="" alt="" width="264"><p>添加地址到环境变量</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">C:\\Users\\Administrator&gt;adb version</span>
<span class="line">Android Debug Bridge version 1.0.41</span>
<span class="line">Version 35.0.2-12147458</span>
<span class="line">Installed as C:\\Users\\Administrator\\AppData\\Local\\Android\\Sdk\\platform-tools\\adb.exe</span>
<span class="line">Running on Windows 10.0.26100</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">C:\\Users\\Administrator&gt;adb connect 192.168.0.101:5555</span>
<span class="line">failed to authenticate to 192.168.0.101:5555</span>
<span class="line">//这里失败一次是因为电视弹出确认框，允许开发电脑调试操作，再试一次就可以了</span>
<span class="line">C:\\Users\\Administrator&gt;adb connect 192.168.0.101:5555</span>
<span class="line">already connected to 192.168.0.101:5555</span>
<span class="line"></span>
<span class="line">C:\\Users\\Administrator&gt;adb devices</span>
<span class="line">List of devices attached</span>
<span class="line">192.168.0.101:5555      device</span>
<span class="line">emulator-5554   device</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>make project 在项目的 <code>app/build/outputs/apk/debug</code> 目录下找到生成的 APK 文件(如果是 debug 版本),在当前目录下打开命令行</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">adb install app-debug.apk</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;adb install app-debug.apk</span>
<span class="line">adb.exe: more than one device/emulator</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;adb install app-debug.apk</span>
<span class="line">adb.exe: more than one device/emulator</span>
<span class="line"></span>
<span class="line">D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;adb devices</span>
<span class="line">List of devices attached</span>
<span class="line">192.168.0.101:5555      device</span>
<span class="line">emulator-5554   device</span>
<span class="line"></span>
<span class="line">//使用-s来指定设备安装</span>
<span class="line">D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;adb -s 192.168.0.101:5555 install app-debug.apk</span>
<span class="line">Performing Streamed Install</span>
<span class="line">Success</span>
<span class="line"></span>
<span class="line">D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>应用安装成功后，可能由于某些原因未能正常启动或者在后台崩溃，从而导致在电视主屏幕上看不到应用图标。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">2025-04-19 11:17:06.342 22227-22227 i.mitv.appstor          com.xiaomi.mitv.appstore             E  Failed to open APK &#39;/data/app/com.example.mitv01-ihXp-pH9MuFKjakJ23XOmw==/base.apk&#39; I/O error</span>
<span class="line">2025-04-19 11:17:06.342 22227-22227 ResourcesManager        com.xiaomi.mitv.appstore             E  failed to add asset path /data/app/com.example.mitv01-ihXp-pH9MuFKjakJ23XOmw==/base.apk</span>
<span class="line">//分析下来应该是io的报错，看看是不是没有存储相关的权限</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">     //AndroidManifest.xml 中声明必要权限</span>
<span class="line">    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span>
<span class="line">    &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;</span>
<span class="line">    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">PS D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt; adb shell df /data</span>
<span class="line">Filesystem       1K-blocks   Used Available Use% Mounted on</span>
<span class="line">/dev/block/dm-38   6082144 839192   5100740  15% /data/user/0</span>
<span class="line">//这里剩余空间还有5个G，远大于标准的100M，可以确定安装失败和剩余空间没有关系</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ADB 安装成功但应用被禁用或未启用。</p><p>adb shell pm enable com.example.mitv01</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">PS D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt; adb shell pm enable com.example.mitv01</span>
<span class="line">Package com.example.mitv01 new state: enabled</span>
<span class="line">PS D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">//确保 ADB 连接时使用的是默认用户（用户 0）</span>
<span class="line">adb install --user 0 app-debug.apk</span>
<span class="line">//查看应用安装路径</span>
<span class="line">adb shell pm path com.example.mitv01</span>
<span class="line"># 正常输出示例：package:/data/app/~~xxxxx==/com.example.mitv01-xxxxx==/base.apk</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">//强制重启电视，保证刷新扫描新安装的应用</span>
<span class="line">adb reboot</span>
<span class="line">//查看电视系统版本</span>
<span class="line">PS D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt; adb shell getprop ro.build.version.release</span>
<span class="line">14</span>
<span class="line">// targetSdkVersion 设置为 34（Android 14 对应的 API 级别是 34）</span>
<span class="line">//但是这里我犯了一个错误,没有指定设备</span>
<span class="line">PS D:\\12_workspace\\android_workspace\\mitv01\\app\\build\\outputs\\apk\\debug&gt; adb -s 192.168.0.101 shell getprop ro.build.version.release</span>
<span class="line">9</span>
<span class="line">//这下确定了电视的系统是Android9 API 28</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>//logcat界面居然也好心的提示了</p><img src="`+d+'" title="" alt="" width="303"><p>使用以下<code>adb</code>命令能获取到设备上所有已安装应用的包名</p><p>adb -s 192.168.0.101:5555 shell pm list packages</p><p><strong>获取用户安装的应用</strong>：</p><p>adb -s 192.168.0.101:5555 shell pm list packages -3</p><p>卸载应用</p><p>adb -s 192.168.0.101:5555 uninstall com.example.mitv01</p><p>安装应用</p><p>adb -s 192.168.0.101:5555 install -r -t .\\app-release.apk</p><p>还是老问题</p><p>--------- beginning of system 2025-04-19 19:37:18.194 15072-15072 i.mitv.appstor com.xiaomi.mitv.appstore E Failed to open APK &#39;/data/app/com.example.mitv01-JocmQXgAAnVUIM45qXZpww==/base.apk&#39; I/O error 2025-04-19 19:37:18.194 15072-15072 ResourcesManager com.xiaomi.mitv.appstore E failed to add asset path /data/app/com.example.mitv01-JocmQXgAAnVUIM45qXZpww==/base.apk</p><p>//看看是否存在com.example.mitv01</p><p>PS D:\\12_workspace\\android_workspace\\mitv01\\app\\release&gt; adb -s 192.168.0.101:5555 shell pm list packages | Select-String -Pattern &quot;com.example.mitv01&quot;</p><p>package:com.example.mitv01</p><p>//获取com.example.mitv01的文件位置</p><p>PS D:\\12_workspace\\android_workspace\\mitv01\\app\\release&gt; adb -s 192.168.0.101:5555 shell pm path com.example.mitv01 package:/data/app/com.example.mitv01-KoLN8yVxnDCikI02DeVM9g==/base.apk PS D:\\12_workspace\\android_workspace\\mitv01\\app\\release&gt;</p><p>//尝试启动应用</p><p>PS D:\\12_workspace\\android_workspace\\mitv01\\app\\release&gt; adb -s 192.168.0.101:5555 shell am start -n com.example.mitv01/.MainActivity Starting: Intent { cmp=com.example.mitv01/.MainActivity } PS D:\\12_workspace\\android_workspace\\mitv01\\app\\release&gt;</p><p>//查看应用日志信息</p><p>adb -s 192.168.0.101:5555 logcat | Select-String -Pattern &quot;com.example.mitv01&quot;</p><p>//既然应用能够成功启动，那就说明 APK 文件本身基本是没问题的，之前日志里提到的 <code>Failed to open APK</code> 错误可能是 <code>com.xiaomi.mitv.appstore</code> 在特定操作时产生的临时性问题。</p>',50)]))}const m=s(p,[["render",t]]),o=JSON.parse('{"path":"/posts/adb%E8%B0%83%E8%AF%95.html","title":"","lang":"zh-CN","frontmatter":{"date":"2025-04-20T00:00:00.000Z","category":["移动开发"],"tag":["adb"],"archive":true},"headers":[],"git":{"updatedTime":1745220460000,"contributors":[{"name":"syf5sssss","username":"syf5sssss","email":"1806300322@qq.com","commits":1,"url":"https://github.com/syf5sssss"}],"changelog":[{"hash":"f17fe84a4bdbf176c8790f1420c0ad5a0a24c6db","time":1745220460000,"email":"1806300322@qq.com","author":"syf5sssss","message":"初步搭建vuepress"}]},"filePathRelative":"posts/adb调试.md","excerpt":"<p>adb调试</p>\\n<p>连接同一个网络，打开电视的开发者模式，开启adb调试。</p>\\n<div class=\\"language-text line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"text\\"><pre><code><span class=\\"line\\">//连接到电视 TV 设备</span>\\n<span class=\\"line\\">adb connect your_tv_ip:5555</span>\\n<span class=\\"line\\">//查看已连接的设备</span>\\n<span class=\\"line\\">adb devices</span>\\n<span class=\\"line\\">//</span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}');export{m as comp,o as data};
